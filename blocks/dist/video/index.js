(()=>{"use strict";const e=window.wp.blocks,o=JSON.parse('{"UU":"vimeify/video"}'),t=window.React,a=window.wp.blockEditor,l=window.wp.components,i=window.wp.element,n=window.wp.data,r=window.wp.i18n,{UU:c}=o;(0,e.registerBlockType)(c,{attributes:{currentValue:{type:"string"}},edit:({attributes:e,setAttributes:o})=>{const c=window.WPVimeoVideos?window.WPVimeoVideos:null,s=window.Vimeify.upload_block_options&&window.Vimeify.upload_block_options.notifyEndpoint?window.Vimeify.upload_block_options.notifyEndpoint:"",u=window.Vimeify.upload_block_options.methods?window.Vimeify.upload_block_options.methods:{},m=window.Vimeify.upload_block_options.nonce?window.Vimeify.upload_block_options.nonce:"",d=window.Vimeify.upload_block_options.restBase?window.Vimeify.upload_block_options.restBase:"",p=window.Vimeify.upload_block_options.accessToken?window.Vimeify.upload_block_options.accessToken:"",f=window.Vimeify.upload_block_options.upload_form_options.enable_view_privacy?1:0,v=f?(e=>{const o={};for(let t in e)e[t].available&&(o[t]=e[t]);return o})(window.Vimeify.upload_block_options.upload_form_options.privacy_view):[],_=Object.keys(v).find((e=>!0===v[e].default)),w=window.Vimeify.upload_block_options.upload_form_options.enable_folders?1:0,y=window.Vimeify.upload_block_options.upload_form_options.default_folder,h=(0,a.useBlockProps)(),b={label:"Select result...",value:""},[E,V]=(0,i.useState)(""),[g,S]=(0,i.useState)(""),[k,C]=(0,i.useState)(""),[T,P]=(0,i.useState)(null),[N,B]=(0,i.useState)(null),[U,x]=(0,i.useState)(_),[O,W]=(0,i.useState)(y.uri),[F,j]=(0,i.useState)(!1),[L,J]=(0,i.useState)(0),[R,q]=(0,i.useState)(""),[A,D]=(0,i.useState)([]),[I,z]=(0,i.useState)(""),[G,H]=(0,i.useState)([]),[K,M]=(0,i.useState)(""),[Q,X]=(0,i.useState)([]),{savePost:Y}=(0,n.useDispatch)("core/editor");return(0,i.useEffect)((()=>{const e=setTimeout((()=>{I.length>2&&new c.Profile(p).search({page:1,per_page:100,query:I,sort:"date",direction:"desc",onSuccess:function(e){e.data.length>0&&H(e.data)},onError:function(e){console.warn("Vimeify: Unable to search remote profile."),console.warn(e),alert("Search error: "+e.message)}})}),800);return()=>clearTimeout(e)}),[I]),(0,i.useEffect)((()=>{const e=setTimeout((async()=>{if(K.length>2)try{const e=await fetch(d+"vimeify/v1/videos?s="+K+"&_wpnonce="+m),o=await e.json();X(o?.data)}catch(e){console.warn("Error searching local videos:"),console.warn(e),alert("Search error: "+e.message)}}),800);return()=>clearTimeout(e)}),[K]),(0,i.useEffect)((()=>{const e=setTimeout((async()=>{if(R.length>2)try{const e=await fetch(d+"vimeify/v1/folders?query="+R+"&_wpnonce="+m),o=await e.json();D([y].concat(o?.data?o?.data:[]))}catch(e){console.warn("Error searching folders:"),console.warn(e),alert("Search error: "+e.message)}}),800);return()=>clearTimeout(e)}),[R]),(0,t.createElement)("div",{...h},(0,t.createElement)("div",{className:e.currentValue?"vimeify-upload-form":""},e.currentValue&&""!==e.currentValue&&(0,t.createElement)("div",null,(0,t.createElement)("iframe",{width:"auto",height:"400",src:"https://player.vimeo.com/video/"+e.currentValue.replace("/videos/",""),frameBorder:"0",allow:"autoplay; encrypted-media",webkitallowfullscreen:!0,mozallowfullscreen:!0,allowFullScreen:!0}),(0,t.createElement)("hr",null),(0,t.createElement)("div",{style:{textAlign:"center"}},(0,t.createElement)(l.Button,{onClick:e=>{V(""),o({currentValue:""})},variant:"secondary"},(0,r.__)("Clear","vimeify")))),e.currentValue&&""!==e.currentValue?"":(0,t.createElement)(t.Fragment,null,(0,t.createElement)("h3",{className:"vimeify-block-title"},"Vimeo"),(0,t.createElement)("div",{style:{marginBottom:"15px"}},(0,t.createElement)(l.RadioControl,{label:(0,r.__)("Upload/Select Vimeo Video","vimeify"),selected:E,options:[{label:u.upload,value:"upload"},{label:u.local,value:"local"},{label:u.search,value:"search"}],onChange:e=>V(e)})),"upload"===E&&(0,t.createElement)("div",{className:"vimeify-upload-form-inner"},(0,t.createElement)(l.TextControl,{label:(0,r.__)("Title","vimeify"),value:g,onChange:e=>S(e)}),(0,t.createElement)(l.TextareaControl,{label:(0,r.__)("Description","vimeify"),value:k,onChange:e=>C(e)}),1===parseInt(f)&&(0,t.createElement)(l.SelectControl,{label:(0,r.__)("View Privacy","vimeify"),help:(0,r.__)("Who will be able to view this video","vimeify"),value:U,options:Object.keys(v).map((e=>({label:v[e].name,value:e}))),onChange:e=>x(e)}),1===parseInt(w)&&(0,t.createElement)("div",null,(0,t.createElement)(l.TextControl,{label:(0,r.__)("Folder","vimeify"),placeholder:(0,r.__)("Search for folders or leave blank","vimeify"),value:R,help:0===A.length?(0,r.__)("Where this video should be uploaded to?","vimeify"):"",onChange:e=>q(e)}),A.length>0&&(0,t.createElement)(l.SelectControl,{help:(0,r.__)("Where this video should be uploaded to?","vimeify"),value:O,options:A.map((e=>({label:e.name,value:e.uri}))),onChange:e=>W(e)})),T&&(0,t.createElement)("p",null,"Selected: ",T.name),(0,t.createElement)(l.FormFileUpload,{accept:"video/*",variant:"secondary",onChange:e=>P(e.currentTarget.files[0])},T?(0,r.__)("Replace Video","vimeify"):(0,r.__)("Select Video","vimeify")),F&&(0,t.createElement)("div",{className:"vimeify-progress"},(0,t.createElement)("div",{className:"vimeify-progress-value",style:{width:L+"%"}})),T&&(0,t.createElement)("div",{style:{marginTop:"10px"}},(0,t.createElement)(l.Button,{onClick:e=>{if(!c.Uploader.validateVideo(T))return alert((0,r.__)("Please select valid video file.","vimeify")),!1;new c.Uploader(p,T,{title:g,description:k,privacy:U,folder:O,wp:{notify_endpoint:s},beforeStart:function(){j(!0),J(.25)},onProgress:function(e,o){J((e/o*100).toFixed(2))},onSuccess:function(e,t){V(""),o({currentValue:t.uri}),Y()},onError:function(e){j(!1),alert("Vimeo upload error.")},onVideoCreateError:function(e){let o="";const t=JSON.parse(e);o=t.hasOwnProperty("invalid_parameters")?t.invalid_parameters[0].developer_message:t.developer_message,j(!1),alert(o)},onWPNotifyError:function(e){let o="";const t=JSON.parse(e);o=t.hasOwnProperty("data")?t.data:"Error notifying WordPress about the file upload.",j(target,!0),alert(o)}}).start()},variant:"primary"},(0,r.__)("Upload","vimeify")))),"search"===E&&(0,t.createElement)("div",{className:"vimeify-remote-search-form"},(0,t.createElement)(l.TextControl,{label:(0,r.__)("Search your Vimeo.com account","vimeify"),value:I,onChange:e=>z(e)}),G.length>0&&(0,t.createElement)(l.SelectControl,{label:(0,r.__)("Videos List","vimeify"),value:N,options:[b].concat(G.map((e=>({label:e.name,value:e.uri})))),onChange:e=>B(e)}),N&&(0,t.createElement)(l.Button,{onClick:e=>{V(""),o({currentValue:N})},variant:"primary"},(0,r.__)("Save","vimeify"))),"local"===E&&(0,t.createElement)("div",{className:"vimeify-local-search-form"},(0,t.createElement)(l.TextControl,{label:(0,r.__)("Search your Local Library","vimeify"),value:K,onChange:e=>M(e)}),Q.length>0&&(0,t.createElement)(l.SelectControl,{label:(0,r.__)("Videos List","vimeify"),value:N,options:[b].concat(Q.map((e=>({label:e.name,value:e.uri})))),onChange:e=>B(e)}),N&&(0,t.createElement)(l.Button,{onClick:e=>{V(""),o({currentValue:N})},variant:"primary"},(0,r.__)("Save","vimeify"))))))},save:()=>null})})();