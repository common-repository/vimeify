!function r(a,s,n){function i(t,e){if(!s[t]){if(!a[t]){var o="function"==typeof require&&require;if(!e&&o)return o(t,!0);if(p)return p(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}o=s[t]={exports:{}},a[t][0].call(o.exports,function(e){return i(a[t][1][e]||e)},o,o.exports,r,a,s,n)}return s[t].exports}for(var p="function"==typeof require&&require,e=0;e<n.length;e++)i(n[e]);return i}({1:[function(e,t,o){window.hasOwnProperty("WPVimeoVideos")||(window.WPVimeoVideos={}),window.WPVimeoVideos.Uploader=function(e,t,o){this.accessToken=e,this.accept="application/vnd.vimeo.*+json;version=3.4",this.chunkSize=5e6,this.file=t,this.params=o,this.endpoints={create_video:"https://api.vimeo.com/me/videos",delete_video:"https://api.vimeo.com/",me:"https://api.vimeo.com/me/videos"},this.currentTusUploader=null,this.currentUpload=null},WPVimeoVideos.Uploader.serializeObject=function(e,t,o){if(o=o||[],"object"==typeof e)for(var r in e)WPVimeoVideos.Uploader.serializeObject(e[r],t?t+"["+r+"]":r,o);else o.push(t+"="+encodeURIComponent(e));return o.join("&")},WPVimeoVideos.Uploader.validateVideo=function(e){return console.log(e),e instanceof File?!(e.size<=0)&&-1!==e.type.indexOf("video/"):(console.log("Fails 3"),!1)},WPVimeoVideos.Uploader.prototype.start=function(){var r=this,a=new XMLHttpRequest,e={name:r.params.title,description:r.params.description,upload:{approach:"tus",size:r.file.size}},e=(r.params.hasOwnProperty("privacy")&&"default"!==r.params&&(e.privacy={view:r.params.privacy}),r.params.hasOwnProperty("folder")&&r.params.folder&&"default"!==r.params.folder&&(e.folder_uri=r.params.folder),JSON.stringify(e));a.open("POST",r.endpoints.create_video,!0),a.setRequestHeader("Authorization","bearer "+this.accessToken),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("Accept",this.accept),a.onreadystatechange=function(){var e,t,o;4===a.readyState&&(e=a.responseText,200===a.status?(o=(t=JSON.parse(e)).upload.upload_link,r.uploadToVimeo(o),r.currentUpload=t):r.params.hasOwnProperty("onVideoCreateError")&&r.params.onVideoCreateError(e))},r.params.hasOwnProperty("beforeStart")&&r.params.beforeStart(),a.send(e)},WPVimeoVideos.Uploader.prototype.abort=function(r,a){var s;this.currentTusUploader&&(s=this).currentTusUploader.abort(!0,function(e){var t=new XMLHttpRequest,o=s.endpoints.delete_video+s.currentUpload.uri;t.open("DELETE",o,!0),t.setRequestHeader("Authorization","bearer "+s.accessToken),t.setRequestHeader("Content-Type","application/json"),t.setRequestHeader("Accept",s.accept),t.onreadystatechange=function(){t.readyState===XMLHttpRequest.DONE&&(200<t.status&&t.status<210?r&&r(t.status,t.responseText):400<t.status&&t.status<500&&a&&a(t.status,t.responseText))},t.send()})},WPVimeoVideos.Uploader.prototype.uploadToVimeo=function(e){var o=this;this.file&&(e={endpoint:e,uploadUrl:e,chunkSize:o.chunkSize,retryDelays:[0,1e3,3e3,5e3],metadata:{filename:o.file.name,filetype:o.file.type},headers:{Accept:o.accept}},o.params.hasOwnProperty("onError")&&(e.onError=function(e){o.params.onError(e)}),o.params.hasOwnProperty("onProgress")&&(e.onProgress=function(e,t){o.params.onProgress(e,t)}),e.onSuccess=function(){o.notifyWP(function(e){o.params.hasOwnProperty("onSuccess")&&o.params.onSuccess(e,o.currentUpload)})},this.currentTusUploader=new tus.Upload(o.file,e),this.currentTusUploader.start())},WPVimeoVideos.Uploader.prototype.notifyWP=function(o){var r,e,a=this;!a.params.hasOwnProperty("wp")||a.params.hasOwnProperty("wp")&&!a.params.wp.hasOwnProperty("notify_endpoint")||!1===a.params.wp.notify_endpoint?(!1===a.params.wp.notify_endpoint?console.log("Notify endpoint disabled."):console.log("Not valid notify_endpoint specified."),o(null)):((r=new XMLHttpRequest).open("POST",a.params.wp.notify_endpoint,!0),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded;"),r.onreadystatechange=function(){var e,t;4===r.readyState&&(e=r.responseText,200===r.status?(t=JSON.parse(e),o(t)):a.params.hasOwnProperty("onWPNotifyError")&&a.params.onWPNotifyError(e))},e={title:a.params.title,description:a.params.description,uri:a.currentUpload.uri,size:a.file.size,meta:a.params.wp.hasOwnProperty("notify_meta")?a.params.wp.notify_meta:null},a.params.hasOwnProperty("folder")&&a.params.folder&&"default"!==a.params.folder&&(e.folder_uri=a.params.folder),a.params.hasOwnProperty("privacy")&&a.params.privacy&&"default"!==a.params.privacy&&(e.view_privacy=a.params.privacy),r.send(WPVimeoVideos.Uploader.serializeObject(e)))},WPVimeoVideos.Profile=function(e){this.accessToken=e,this.accept="application/vnd.vimeo.*+json;version=3.4",this.endpoints={search:"https://api.vimeo.com/me/videos"}},WPVimeoVideos.Profile.prototype.search=function(t){var e,o=new XMLHttpRequest,r={};for(e in t)"onSuccess"!==e&&"onError"!==e&&(r[e]=t[e]);r=WPVimeoVideos.Uploader.serializeObject(r),o.open("GET",this.endpoints.search+"?"+r,!0),o.setRequestHeader("Authorization","bearer "+this.accessToken),o.setRequestHeader("Content-Type","application/json"),o.setRequestHeader("Accept",this.accept),o.onreadystatechange=function(){var e;4===o.readyState&&(e=o.responseText,e=JSON.parse(e),200===o.status?t.hasOwnProperty("onSuccess")&&t.onSuccess(e):t.hasOwnProperty("onError")&&t.onError(e))},o.send()}},{}]},{},[1]);
//# sourceMappingURL=uploader.js.map
