{"version":3,"names":[],"mappings":"","sources":["chunked-upload.js"],"sourcesContent":["!function t(a,r,o){function s(i,e){if(!r[i]){if(!a[i]){var n=\"function\"==typeof require&&require;if(!e&&n)return n(i,!0);if(d)return d(i,!0);throw(e=new Error(\"Cannot find module '\"+i+\"'\")).code=\"MODULE_NOT_FOUND\",e}n=r[i]={exports:{}},a[i][0].call(n.exports,function(e){return s(a[i][1][e]||e)},n,n.exports,t,a,r,o)}return r[i].exports}for(var d=\"function\"==typeof require&&require,e=0;e<o.length;e++)s(o[e]);return s}({1:[function(e,i,n){function t(e,i){var n,t;null!==w?setTimeout(i):(n=(()=>{for(var e=\"\",i=0;i<k.payloadSize;++i)e+=String.fromCharCode(Math.round(36*Math.random()+64));return e})(),t=new Date,wp.ajax.post({action:_(e,\"file_upload_speed_test\"),data:n}).then(function(){var e=new Date-t;w=e>=k.maxTime,i()}).fail(function(){w=!0,i()}))}function u(e){function i(){n.find(\".vimeify-uploading-in-progress-alert\").length||n.find(\".vimeify-submit-container\").before('<div class=\"vimeify-error-alert vimeify-uploading-in-progress-alert\">'+window.Vimeify_Chunked_Upload.loading_message+\"</div>\")}var n,t=jQuery(e.element).closest(\"form\"),a=t.find(\"input[type=submit]\"),e=(a.length||(a=t.find(\"button[type=submit]\")),e.loading<0&&(e.loading=0),0<e.loading);n=t;e?(a.prop(\"disabled\",!0),t.find(\".vimeify-submit-overlay\").length||(a.parent().addClass(\"vimeify-submit-overlay-container\"),a.parent().append('<div class=\"vimeify-submit-overlay\"></div>'),t.find(\".vimeify-submit-overlay\").css(\"width\",a.outerWidth()+\"px\"),t.find(\".vimeify-submit-overlay\").css(\"height\",a.parent().outerHeight()+\"px\"),t.find(\".vimeify-submit-overlay\").on(\"click\",i))):(a.prop(\"disabled\",!1),t.find(\".vimeify-submit-overlay\").off(\"click\",i),t.find(\".vimeify-submit-overlay\").remove(),a.parent().removeClass(\"vimeify-submit-overlay-container\"),t.find(\".vimeify-uploading-in-progress-alert\").length&&t.find(\".vimeify-uploading-in-progress-alert\").remove())}function f(e){try{return JSON.parse(e)}catch(e){return!1}}function a(e){return 0<e.length}function r(e){return e}function o(e){return e.chunkResponse||e.xhr}function s(e){return\"string\"==typeof e?e:e.responseText}function d(e){return e.data}function p(e){var i=jQuery(e.element).closest(\".vimeify-chunked-uploader-wrapper\").find(\"input[name=\"+e.dataTransfer.name+\"]\");i.val((e=e.files,(e=e.map(o).filter(r).map(s).filter(a).map(f).filter(r).map(d)).length?JSON.stringify(e):\"\")).trigger(\"input\"),void 0!==jQuery.fn.valid&&i.valid()}function l(e,i){var n;e.isErrorNotUploadedDisplayed||((n=document.createElement(\"span\")).innerText=i.toString(),n.setAttribute(\"data-dz-errormessage\",\"\"),e.previewElement.querySelector(\".dz-error-message\").appendChild(n))}function c(t){return function i(n){n.retries||(n.retries=0),\"error\"!==n.status&&(wp.ajax.post(jQuery.extend({action:_(t,\"file_chunks_uploaded\"),key:t.dataTransfer.key,name:n.name},t.options.params.call(t,null,null,{file:n,index:0}))).then(function(e){n.chunkResponse=JSON.stringify({data:e}),t.loading=t.loading||0,t.loading--,u(t),p(t)}).fail(function(e){e.responseJSON&&!1===e.responseJSON.success&&e.responseJSON.data?l(n,e.responseJSON.data):(n.retries++,3===n.retries?l(n,window.Vimeify_Chunked_Upload.errors.file_not_uploaded):setTimeout(function(){i(n)},5e3*n.retries))}),t.processQueue())}}function m(e){setTimeout(function(){e.files.filter(function(e){return e.accepted}).length>=e.options.maxFiles?e.element.querySelector(\".dz-message\").classList.add(\"hide\"):e.element.querySelector(\".dz-message\").classList.remove(\"hide\")},0)}function y(a){return function(e){var i,n;e.size>=a.dataTransfer.postMaxSize?(i=e,n=a,setTimeout(function(){var e;i.size>=n.dataTransfer.postMaxSize&&(e=window.Vimeify_Chunked_Upload.errors.post_max_size,i.isErrorNotUploadedDisplayed||(i.isErrorNotUploadedDisplayed=!0,e=window.Vimeify_Chunked_Upload.errors.file_not_uploaded+\" \"+e,l(i,e)))},1)):t(a,function(){var n,t;n=a,t=e,wp.ajax.post(jQuery.extend({action:_(n,\"upload_chunk_init\"),key:n.dataTransfer.key,name:t.name,slow:w},n.options.params.call(n,null,null,{file:t,index:0}))).then(function(e){for(var i in e)n.options[i]=e[i];e.dzchunksize&&(n.options.chunkSize=parseInt(e.dzchunksize,10),t.upload.totalChunkCount=Math.ceil(t.size/n.options.chunkSize)),n.processQueue()}).fail(function(e){t.status=\"error\",l(t,e),n.processQueue()})}),a.loading=a.loading||0,a.loading++,u(a),m(a)}}function v(e,i){wp.ajax.post({action:_(i,\"remove_file\"),file:e,key:i.dataTransfer.key})}function h(e){var t,n,i=e.dataset.fieldKey,a=parseInt(e.dataset.maxFileNumber,10),r=e.dataset.extensions.split(\",\").map(function(e){return\".\"+e}).join(\",\"),o=new window.Dropzone(e,{url:window.Vimeify_Chunked_Upload.url,addRemoveLinks:!0,chunking:!0,forceChunking:!0,retryChunks:!0,chunkSize:parseInt(e.dataset.fileChunkSize,10),paramName:e.dataset.inputName,parallelChunkUploads:!!(e.dataset.parallelUploads||\"\").match(/^true$/i),parallelUploads:parseInt(e.dataset.maxParallelUploads,10),autoProcessQueue:!1,maxFilesize:(parseInt(e.dataset.maxSize,10)/1048576).toFixed(2),maxFiles:a,acceptedFiles:r,dictMaxFilesExceeded:window.Vimeify_Chunked_Upload.errors.file_limit.replace(\"{fileLimit}\",a),dictInvalidFileType:window.Vimeify_Chunked_Upload.errors.file_extension,dictFileTooBig:window.Vimeify_Chunked_Upload.errors.file_size});if(o.dataTransfer={key:i,postMaxSize:e.dataset.maxSize,name:e.dataset.inputName},e.nextElementSibling)try{var s,d=JSON.parse(e.nextElementSibling.value);for(s in d){var l={name:d[s].file_user_name,size:d[s].size,server_file:d[s].file};o.emit(\"addedfile\",l),o.emit(\"complete\",l)}}catch(e){}return o.on(\"sending\",(t={action:_(o,\"upload_chunk\"),key:i},function(e,i,n){e.size>this.dataTransfer.postMaxSize?(i.send=function(){},e.accepted=!1,e.processing=!1,e.status=\"rejected\",e.previewElement.classList.add(\"dz-error\"),e.previewElement.classList.add(\"dz-complete\")):Object.keys(t).forEach(function(e){n.append(e,t[e])})})),o.on(\"addedfile\",y(o)),o.on(\"removedfile\",(n=o,function(e){m(n);var i=e.chunkResponse||(e.xhr||{}).responseText;i?(i=f(i))&&i.data&&i.data.file&&v(i.data.file,n):e.hasOwnProperty(\"server_file\")&&e.server_file&&v(e.server_file,n),p(n),n.loading=n.loading||0,n.loading--,u(n)})),o.on(\"complete\",c(o)),o.on(\"error\",function(e,i){e.isErrorNotUploadedDisplayed||(e.isErrorNotUploadedDisplayed=!0,e.previewElement.querySelectorAll(\"[data-dz-errormessage]\")[0].textContent=window.Vimeify_Chunked_Upload.errors.file_not_uploaded+\" \"+i)}),o}function _(e,i){return e.element.dataset.handler+\"_\"+i}function g(){window.vimeify_chunked_upload_fields=window.vimeify_chunked_upload_fields||{},window.vimeify_chunked_upload_fields.dropzones=[].slice.call(document.querySelectorAll(\".vimeify-chunked-uploader\")).map(h)}var w,k,x;w=null,k={maxTime:3e3,payloadSize:102400},(x={init:function(){\"loading\"===document.readyState?document.addEventListener(\"DOMContentLoaded\",g):g()}}).init(),window.vimeifyChunkedFileUpload=x},{}]},{},[1]);"],"file":"chunked-upload.js"}